<%- include("../admin/layouts/adminHeader.ejs") %>

<style>
  .form-style {
    width: 550px;
    height: 42px;
    background-color: rgb(255, 255, 255);
    border: 1px solid #ccc;
    border-radius: 5px;
    margin-left: 15px;
  }

  .image-preview-container {
    position: relative;
    margin-top: 10px;
  }

  .image-preview {
    width: 100%;
    height: auto;
    max-height: 200px; /* Set a maximum height for the preview */
    border: 1px solid #ccc;
    border-radius: 5px;
  }

  .delete-image-btn {
    position: absolute;
    top: 5px;
    right: 5px;
    background-color: #fff;
    border: none;
    padding: 5px;
    cursor: pointer;
    display: none;
  }
</style>

<body class="g-sidenav-show bg-gray-200">
  <%- include("../admin/layouts/adminSideBar.ejs") %>
  <main class="main-content position-relative max-height-vh-100 h-100 border-radius-lg">
    <!-- Navbar -->
    <%- include("../admin/layouts/adminNavBar.ejs") %>
    <!-- End Navbar -->
    <div class="container-fluid py-4">
      <div class="row">
        <div class="col-12 elemDesign">
          <div class="card my-4">
            <div class="card-header p-0 position-relative mt-n4 mx-3 z-index-2 elemDesign2">
              <div class="bg-gradient-primary shadow-primary border-radius-lg pt-4 pb-3">
                <h6 class="text-white text-capitalize ps-3">ADD PRODUCT</h6>
              </div>
            </div>
            <div class="card-body px-0 pb-2">
              <form class="forms-sample" action="/admin/addproduct" method="post" enctype="multipart/form-data" style="background-color: #efefef;" id="productForm">

                <div class="row">
                  <div class="col-6">
                    <div class="form-group">
                      <label for="productName" class="font-weight-bold pl-3" style="color: #000000;">Product Name</label>
                      <input type="text" class="form-control form-style" name="productName" id="productName" placeholder="Name">
                      <span class="error" style="color: red;  margin-left: 15px; font-size: 10px;"></span>
                    </div>
                  </div>
                  <div class="col-6">
                    <div class="form-group">
                      <label for="price" class="font-weight-bold pl-3" style="color: #080000;">Price</label>
                      <input type="number" class="form-control form-style" id="price" name="price" placeholder="price" >
                      <span class="error" style="color: red;  margin-left: 15px; font-size: 10px;"></span>
                    </div>
                  </div>
                </div>

                <div class="row">
                  <div class="col-6">
                    <div class="form-group">
                      <label for="brand" class="font-weight-bold pl-3" style="color: #000000;">Brand</label>
                      <input type="text" class="form-control form-style" name="brand" id="brand" placeholder="brand" >
                      <span class="error" style="color: red;  margin-left: 15px; font-size: 10px;"></span>
                    </div>
                  </div>
                  <div class="col-6">
                    <div class="form-group">
                      <label class="font-weight-bold pl-3" style="color: #000000;">Category</label>
                      <select name="category" class="form-control form-style" >
                        <option   selected>Select Category</option>
                        <span class="error" style="color: red;  margin-left: 15px; font-size: 10px;"></span>
                        <% for(let i=0;i< cartData.length;i++){ %>
                        <option  value="<%=cartData[i]._id%>">
                          <%= cartData[i].name %>
                        </option>
                        <% } %>
                      </select>
                    </div>
                  </div>
                </div>

                <div class="row">
                  <div class="col-6">
                    <div class="form-group">
                      <label for="status" class="font-weight-bold pl-3" style="color: #000000;">Status</label>
                      <input type="text" class="form-control form-style" id="status" name="status" placeholder="status" >
                      <span class="error" style="color: red;  margin-left: 15px; font-size: 10px;"></span>
                    </div>
                  </div>
                  <div class="col-6">
                    <div class="form-group">
                      <label class="font-weight-bold pl-3" style="color: #000000;">Quantity</label>
                      <input type="number" class="form-control form-style" id="quantity" name="quantity" placeholder="Enter Stock" >
                      <span class="error" style="color: red;  margin-left: 15px; font-size: 10px;"></span>
                    </div>
                  </div>
                </div>

                <div class="form-group mt-2">
                  <label for="description" class="font-weight-bold pl-3 " style="color: #000000;">Description</label>
                  <div class="row">
                    <div class="col-6">
                      <textarea name="description" class="form-control  form-style" id="description" rows="4" ></textarea>
                      <span class="error" style="color: red;  margin-left: 15px; font-size: 10px;"></span>
                    </div>
                    <div class="col-6">
                      <div class="form-group">
                        
                        <div class="col-lg-12 col-md-6 rounded-image-preview">
                          <label class="upload__btn ms-3">
                            <p class="font-weight-bold pl-1" style="color: #000000;">Upload Images</p>
                            <input type="file" id="formFile" name="image" multiple data-max_length="20" class="upload__inputfile">
                            <span class="error" style="color: red; margin-left: 15px; font-size: 10px;"></span>
                          </label>
                        </div>
                        <div class="image-preview-wrapper" style="width:250px; height:250px; display: flex; flex-direction: row;"></div>

                  <button type="submit" class="btn btn-lg btn-primary mr-2 mt-5">Add Product</button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>



 




<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

<script>
  $(document).ready(function () {
    // Function to update image preview
    function readURL(input) {
      if (input.files) {
        var files = input.files;
        for (var i = 0; i < files.length; i++) {
          var reader = new FileReader();
          reader.onload = function (e) {
            var imagePreview = '<div class="image-preview-container">' +
                                '<img class="image-preview" src="' + e.target.result + '" alt="Image Preview">' +
                                '<button class="delete-image-btn" onclick="deleteImage(this)">Delete</button>' +
                                '</div>';
            $('.image-preview-wrapper').append(imagePreview);
          }
          reader.readAsDataURL(files[i]);
        }
      }
    }

    // Update image preview when files are selected
    $("#formFile").change(function () {
      $('.image-preview-wrapper').empty(); // Clear existing previews
      readURL(this);
    });

    // Show/hide delete button on hover
    $(document).on('mouseenter', '.image-preview-container', function() {
      $(this).find('.delete-image-btn').show();
    }).on('mouseleave', '.image-preview-container', function() {
      $(this).find('.delete-image-btn').hide();
    });

    // Function to delete individual image
    window.deleteImage = function (btn) {
      var container = $(btn).parent('.image-preview-container');
      var fileName = container.find('img').attr('src');
      
      // Update the input field by removing the corresponding file
      var fileInput = $('#formFile')[0];
      var files = fileInput.files;
      for (var i = 0; i < files.length; i++) {
        if (files[i].name === fileName) {
          var newFiles = Array.from(files);
          newFiles.splice(i, 1);
          fileInput.files = newFiles;
          break;
        }
      }
      
      // Remove the image preview container
      container.remove();
    };
  });
</script>
  
    
      <%- include("../admin/layouts/adminFooter.ejs") %>