
<%- include('../users/mainLayout/mainHeader.ejs')%>




<section class="bg0 p-t-23 p-b-130" >
    <div class="container">
        

        <form class="d-flex" role="search">
            <input class="form-control me-2 w-100 " type="search" placeholder="Search" name="search" aria-label="Search">
            <button class="btn btn-outline-dark" type="submit" style="height: 40px;"><i class="bi bi-search" ></i></button>
          </form>
    
        <div class="flex-w flex-sb-m p-b-52">
            <div class="flex-w flex-l-m filter-tope-group m-tb-10">
                
    
               
            </div>
    
            <div class="flex-w flex-c-m m-tb-10">
                <div class="flex-c-m stext-106 cl6 size-104 bor4 pointer hov-btn3 trans-04 m-r-8 m-tb-4 js-show-filter">
                    <i class="icon-filter cl2 m-r-6 fs-15 trans-04 zmdi zmdi-filter-list"></i>
                    <i class="icon-close-filter cl2 m-r-6 fs-15 trans-04 zmdi zmdi-close dis-none"></i>
                     Filter
                </div>
    
                
            </div>
            
            
    
            <!-- Filter -->
            <div class="dis-none panel-filter w-full p-t-10">
    <div class="wrap-filter flex-w bg6 w-full p-lr-40 p-t-27 p-lr-15-sm">
        <div class="filter-col1 p-r-15 p-b-27">
            <div class="mtext-102 cl2 p-b-15">
                Categories
            </div>

            <ul>
                <%catData.forEach((cat)=>{%>

                <li class="p-b-6">
                    <% if(category==cat._id) { %>
                    <a href="?category=<%=cat._id%>&sortValue=<%=sortValue%>&brand=<%=brand%>&minPrice=<%=minPrice%>&maxPrice=<%=maxPrice%>&search=<%=search%>"
                        style="color:#f44072;">
                        <%=cat.name %>
                    </a>
                    <% } else { %>
                    <a href="?category=<%=cat._id%>&sortValue=<%=sortValue%>&brand=<%=brand%>&minPrice=<%=minPrice%>&maxPrice=<%=maxPrice%>&search=<%=search%>"
                        style="color: #636363;">
                        <%=cat.name %>
                    </a>
                    <% } %>
                </li>
                <% })%>
            </ul>
        </div>

        <div class="filter-col1 p-r-15 p-b-27">
            <div class="mtext-102 cl2 p-b-15">
                Brands
            </div>
        
            <ul>
                <% brands.forEach((brand) => { %>
                    <li class="p-b-6">
                        <% if(brand == brand._id) { %>
                            <a href="?brand=<%= brand._id %>&sortValue=<%= sortValue %>&category=<%= category %>&minPrice=<%= minPrice %>&maxPrice=<%= maxPrice %>&search=<%= search %>" style="color: #f44072;">
                                <%= brand._id %>
                            </a>
                        <% } else { %>
                            <a href="?brand=<%= brand._id %>&sortValue=<%= sortValue %>&category=<%= category %>&minPrice=<%= minPrice %>&maxPrice=<%= maxPrice %>&search=<%= search %>" style="color: #636363;">
                                <%= brand._id %>
                            </a>
                        <% } %>
                    </li>
                <% }) %>
            </ul>
        </div>

        <div class="filter-col2 p-r-15 p-b-27">
            <div class="mtext-102 cl2 p-b-15">
                Price
            </div>

            <ul>

                <li class="p-b-6">
                    <% if(maxPrice==3999){ %>
                    <p><a href="?minPrice=0&maxPrice=3999&sortValue=<%=sortValue%>&category=<%=category%>&brand=<%=brand%>&search=<%=search%>"
                            style="color:#f44072;">₹0 - ₹3999</a></p>
                    <% }else{ %>
                    <p><a href="?minPrice=0&maxPrice=3999&sortValue=<%=sortValue%>&category=<%=category%>&brand=<%=brand%>&search=<%=search%>"
                            style="color: #636363;">₹0 - ₹3999</a></p>
                    <% } %>
                    <% if(maxPrice==8999){ %>
                    <p><a href="?minPrice=4000&maxPrice=8999&sortValue=<%=sortValue%>&category=<%=category%>&brand=<%=brand%>&search=<%=search%>"
                            style="color:#f44072;">₹4000 - ₹8999</a>
                    </p>
                    <% }else{ %>
                    <p><a href="?minPrice=4000&maxPrice=8999&sortValue=<%=sortValue%>&category=<%=category%>&brand=<%=brand%>&search=<%=search%>"
                            style="color: #636363;">₹4000 - ₹8999</a>
                    </p>
                    <% } %>
                    <% if(maxPrice==13999){ %>
                    <p><a href="?minPrice=9000&maxPrice=13999&sortValue=<%=sortValue%>&category=<%=category%>&brand=<%=brand%>&search=<%=search%>"
                            style="color:#f44072;">₹9000 - ₹13999</a></p>
                    <% }else{ %>
                    <p><a href="?minPrice=9000&maxPrice=13999&sortValue=<%=sortValue%>&category=<%=category%>&brand=<%=brand%>&search=<%=search%>"
                            style="color: #636363;">₹9000 - ₹13999</a></p>
                    <% } %>
                    <% if(maxPrice==18999){ %>
                    <p><a href="?minPrice=14000&maxPrice=18999&sortValue=<%=sortValue%>&category=<%=category%>&brand=<%=brand%>&search=<%=search%>"
                            style="color:#f44072;">₹14000 - ₹18999</a></p>
                    <% }else{ %>
                    <p><a href="?minPrice=14000&maxPrice=18999&sortValue=<%=sortValue%>&category=<%=category%>&brand=<%=brand%>&search=<%=search%>"
                            style="color: #636363;">₹14000 - ₹18999</a></p>
                    <% } %>
                    <% if(minPrice==19000){ %>
                    <p><a href="?minPrice=19000&sortValue=<%=sortValue%>&category=<%=category%>&brand=<%=brand%>&search=<%=search%>"
                            style="color:#f44072;">₹19000+</a>
                    </p>
                    <% }else{ %>
                    <p><a href="?minPrice=19000&sortValue=<%=sortValue%>&category=<%=category%>&brand=<%=brand%>&search=<%=search%>"
                            style="color: #636363;">₹19000+</a>
                    </p>
                    <% } %>
                </li>
            </ul>
        </div>

        <div class="filter-col4 p-b-27">
            <div class="mtext-102 cl2 p-b-15">
                Sort:
            </div>

            <div class="flex-w p-t-4 ">
                <% if(sortValue&&sortValue==3) {%>
                <a href="?sortValue=3&category=<%=category%>&brand=<%=brand%>&minPrice=<%=minPrice%>&maxPrice=<%=maxPrice%>&search=<%=search%>" class="flex-c-m stext-107 cl6 size-301 bor7 p-lr-15 hov-tag1 trans-04 m-r-5 m-b-5"
                    style="color:#f44072;">
                    Latest
                </a>
                <%}else{%>
                    <a href="?sortValue=3&category=<%=category%>&brand=<%=brand%>&minPrice=<%=minPrice%>&maxPrice=<%=maxPrice%>&search=<%=search%>" class="flex-c-m stext-107 cl6 size-301 bor7 p-lr-15 hov-tag1 trans-04 m-r-5 m-b-5"
                        style="color: #636363;">
                        Latest
                    </a>

                <%}%>
                <% if(sortValue&&sortValue==2) {%>
                <a href="?sortValue=2&category=<%=category%>&brand=<%=brand%>&minPrice=<%=minPrice%>&maxPrice=<%=maxPrice%>&search=<%=search%>" class="flex-c-m stext-107 cl6 size-301 bor7 p-lr-15 hov-tag1 trans-04 m-r-5 m-b-5">
                    Price Low to High
                </a>
                <%}else{%>
                    <a href="?sortValue=2&category=<%=category%>&brand=<%=brand%>&minPrice=<%=minPrice%>&maxPrice=<%=maxPrice%>&search=<%=search%>" class="flex-c-m stext-107 cl6 size-301 bor7 p-lr-15 hov-tag1 trans-04 m-r-5 m-b-5"
                        style="color: #636363;">
                        Price Low to High
                    </a>

               <% }%>
               <% if(sortValue&&sortValue==1) {%>
                <a href="?sortValue=1&category=<%=category%>&brand=<%=brand%>&minPrice=<%=minPrice%>&maxPrice=<%=maxPrice%>&search=<%=search%>" class="flex-c-m stext-107 cl6 size-301 bor7 p-lr-15 hov-tag1 trans-04 m-r-5 m-b-5">
                    Price High to Low
                </a>
            <%}else{%>
                <a href="?sortValue=1&category=<%=category%>&brand=<%=brand%>&minPrice=<%=minPrice%>&maxPrice=<%=maxPrice%>&search=<%=search%>" class="flex-c-m stext-107 cl6 size-301 bor7 p-lr-15 hov-tag1 trans-04 m-r-5 m-b-5"
                    style="color: #636363;">
                    Price High to Low
                </a>
           <% }%>

                
            </div>
        </div>
    </div>
</div>

        </div>
    
        <div class="row isotope-grid">
            <% product.forEach((product)=>{ %>
            <div class="col-sm-6 col-md-4 col-lg-3 p-b-35 isotope-item women">
                <div class="block2">
                    
                        <div class="block2-pic hov-img0 d-flex  " style=" height: 319px; background-color: #F7F7F7;" >
                            <% if(product.offer && product.offer.percentage > 0) { %>
                                <div class="discount-badge" style="background-color: #ff5733;
                               color: #f8f8f8;
                                padding: 5px;
                                 position: absolute;
                                 z-index: 1;
                                width: 74px;">
                                   
                                        <span class="stext-103 size-102">
                                            <%= product.offer.percentage %> % OFF
                                        </span>
                                    
                                </div>
                                <% } %>
                       
                            <img style="width: 300px; height: 319px;" src="/static/adminAssets/images/<%= product.image[0] %>" alt="IMG-PRODUCT">
                    
                            <a href="/productDetails?id=<%= product._id %>" class="block2-btn flex-c-m stext-103 cl2 size-102 bg0 bor2 hov-btn1 p-lr-15 trans-04">
                                Quick View
                            </a>
                        </div>
                    
                        <div class="block2-txt flex-w flex-t p-t-14 ">
                            <div class="block2-txt-child1 flex-col-l">
                                <span class="stext-105 cl3">
                                    <%= product.brand %>
                                </span>
                                <a href="" class="stext-104 cl4 hov-cl1 trans-04 js-name-b2 p-b-6">
                                    <%= product.productName %>   
                                </a>
                    
                                <% if(product.offer && product.offer.percentage>0){%>
                                    <div class="d-flex justify-content-between">
                                    
                                    <span class="stext-105 cl3 " ">
                                     <p class="text-danger">   ₹<%= Math.ceil(product.discountedPrice) %>   </p>
                                    </span>
                                    &nbsp;
                                    &nbsp;
                                    <span class="stext-105 cl3 ">
                                        <del>₹<%= product.price %> </del>  
                                    </span>
                                </div>
                               <% }else{%>
                                <span class="stext-105 cl3 ">
                                    ₹<%= product.price %>  
                                </span>
                              <% }%>
                            </div>

                            
                    
                            <div>
                                <a onclick="addToCart('<%= product._id %>')" class="add-cart"  >
                                    <button><img src="static/userAssets/img/326700_cart_shopping_icon.png" style="height: 19px; padding-right: 6px; width: 26px; margin-bottom: 6px;"></button>
                                    
                                </a>
                                <a id="wishlist-button" >

                                    <button><img src="/static/userAssets/images/icons/icon-heart-01.png" style="height: 19px; padding-right: 6px; width: 26px; margin-bottom: 6px;" alt="ICON"></button>

                                    
                                   
                                </a>
                                
                            </div>
                        </div>

                   
                    
                </div>
            </div>
            <% }) %>
        </div>                  
    
        <!-- Pagination -->
        <nav aria-label="...">
            <ul class="pagination justify-content-end">
                <% for (let i=1; i <=pageCount; i++) { %>
                    <li class="page-item <%= locals.currentPage == i ? 'active' : '' %>">
                        <a class="page-link bg-dark <%= locals.currentPage == i ? 'text-white' : 'text-secondary' %>"
                            href="/shop?page=<%= i %>&sortValue=<%= sortValue %>&category=<%= category %>&brand=<%= brand %>&minPrice=<%= minPrice %>&maxPrice=<%= maxPrice %>&search=<%= search %>">
                            <%= i %>
                        </a>
                    </li>
                    <% } %>
            </ul>
        </nav>

          <!-- Pagination End -->
        
    </div>
    </section>


    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
        
        const wishlistButtons = document.querySelectorAll('#wishlist-button');
    
        
        wishlistButtons.forEach(button => {
            button.addEventListener('click', function (event) {
                event.preventDefault();
    
                
                button.classList.add('red-wishlist-button');
    
                
                Swal.fire({
                    title: 'Item added to your wishlist!',
                    icon: 'success',
                });
            });
        });


        const cartButtons = document.querySelectorAll('#cart-button');
    
        
       

        function addToCart(id) {
  console.log("addToCart function called with id: " + id);
  $.ajax({
    url: "/addTocart",
    method: "post",
    encoded: true,
    data: {
      id: id
    },
  }).done((data) => {
    if (data) {
      console.log(data);

      Swal.fire({
  position: 'top-end',
  icon: 'success',
  title: 'Item has been added to Cart!',
  showConfirmButton: false,
  timer: 1000
})
    } else {
      swal("Fail to add");
    }
  });
}





$(document).ready(function () {
        // Listen for input changes in the search bar
        $('#searchInput').on('input', function () {
            const searchText = $(this).val().toLowerCase();

            // Loop through each row in the table and hide/show based on search text
            $('#user-table tbody tr').each(function () {
                const row = $(this);

                // Check if any cell in the row contains the search text
                const found = row.find('td').toArray().some(function (cell) {
                    const cellText = $(cell).text().toLowerCase();
                    return cellText.includes(searchText);
                });

                // Show or hide the row accordingly
                if (found) {
                    row.show();
                } else {
                    row.hide();
                }
            });
        });
    });


    </script>

    

<%- include('../users/mainLayout/mainFooter.ejs')%>


   